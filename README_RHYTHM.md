# 节奏游戏 - 基于微信小程序框架开发

## 游戏概述

这是一个基于现有微信小程序射击游戏框架改造的节奏游戏。游戏采用竖屏设计，玩家需要在正确的时机按下对应的按键来命中从顶部落下的节拍。

## 游戏特性

### 1. 界面设计
- **竖屏布局**：适配手机竖屏游戏体验
- **四条垂直轨道**：每条轨道对应一个按键
- **顶部信息显示**：实时显示分数、连击数、BPM、精度等信息
- **底部判定区**：160px高的判定区域，分为PERFECT和GOOD区域
- **虚拟按键**：A/S/D/F四个虚拟按键，支持触摸操作

### 2. 游戏玩法
- **节奏点下落**：节拍从屏幕顶部按照节奏落下
- **按键时机**：玩家需要在节拍进入判定区时按下对应按键
- **评分系统**：
  - PERFECT：300分（高精度命中）
  - GOOD：200分（一般精度命中）
  - MISS：0分（未命中或时机错误）
- **连击系统**：连续命中可获得分数加成（最高3倍）
- **难度递增**：BPM从60开始，每16个节拍增加5，最高120

### 3. 反馈系统
- **视觉反馈**：按键按下时高亮显示对应轨道
- **音效反馈**：
  - 鼓声效果（Web Audio API合成）
  - PERFECT/GOOD/MISS不同音效
- **触觉反馈**：命中时设备震动（如果支持）
- **连击中断**：MISS时重置连击数

## 技术实现

### 核心组件

1. **Note类** (`js/rhythm/note.js`)
   - 节拍元素的基础类
   - 处理下落、渲染、碰撞检测

2. **TrackSystem类** (`js/rhythm/track.js`)
   - 管理四条垂直轨道
   - 提供判定区域和按键提示

3. **VirtualKeys类** (`js/rhythm/virtualkeys.js`)
   - 虚拟按键系统
   - 支持触摸和键盘输入

4. **BeatGenerator类** (`js/rhythm/beatgenerator.js`)
   - 基于BPM生成节拍模式
   - 支持多种难度模式

5. **Music类** (`js/runtime/music.js`)
   - 增强的音效系统
   - Web Audio API支持

### 数据管理

**DataBus类** (`js/databus.js`) 已扩展支持：
- 节奏游戏状态管理
- 分数、连击、BPM跟踪
- 统计数据（PERFECT/GOOD/MISS计数）
- 精度计算

## 运行方法

### 在微信开发者工具中运行
1. 打开微信开发者工具
2. 导入项目文件夹
3. 点击编译运行

### 在浏览器中测试
1. 打开 `test.html` 文件
2. 使用键盘 A/S/D/F 键或鼠标点击底部按键
3. 体验游戏功能

## 游戏控制

- **键盘**：A、S、D、F 键分别对应四条轨道
- **触摸**：点击底部对应的虚拟按键
- **重新开始**：游戏结束后点击重新开始按钮

## 难度设计

游戏包含三种模式的节拍模式：
- **简单模式**：单一轨道序列
- **中等模式**：双轨道组合
- **复杂模式**：复杂的多轨道序列

随着游戏进行，BPM逐渐增加，节拍模式也会变得更加复杂。

## 评分系统

- **基础分数**：PERFECT 300分，GOOD 200分
- **连击加成**：每次连击增加10%分数，最高300%
- **精度计算**：(PERFECT + GOOD) / 总命中数 × 100%

## 开发说明

该游戏基于原有的微信小程序射击游戏框架改造，保留了：
- 游戏主循环和渲染系统
- 对象池管理
- 事件系统
- UI框架

新增了完整的节奏游戏逻辑，包括音乐节拍同步、精确的时间判定和丰富的用户反馈。

## 扩展可能

- 添加背景音乐同步
- 引入更多音效和视觉效果
- 实现谱面编辑器
- 添加在线排行榜
- 支持自定义音乐导入