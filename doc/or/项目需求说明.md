# 节奏游戏项目 - 原始需求说明书

## 1. 项目概述

### 1.1 项目背景
基于微信小程序框架开发的音乐节奏游戏，将原有的射击游戏框架改造为节奏游戏，提供竖屏手机游戏体验。

### 1.2 项目目标
开发一款易于上手、富有挑战性的节奏游戏，支持多种节奏模式和难度等级，为玩家提供流畅的游戏体验和即时反馈。

## 2. 核心功能需求

### 2.1 游戏界面需求

#### 2.1.1 布局设计
- **屏幕方向**：竖屏显示（portrait）
- **轨道系统**：4条垂直轨道，从左到右分别对应按键A、S、D、F
- **显示区域划分**：
  - 顶部：游戏信息显示区（分数、连击、BPM、精度等）
  - 中部：节拍下落区域
  - 下部：判定区域和虚拟按键区

#### 2.1.2 判定区域
- 位置：屏幕下方2/3处
- 高度：屏幕高度的1/3
- 判定线：醒目的白色横线
- PERFECT区域：判定线上下各1/12屏幕高度，金色半透明背景
- GOOD区域：判定区域除PERFECT外的区域，绿色半透明背景

#### 2.1.3 信息显示
**左上角显示：**
- 当前分数
- 连击数
- 当前BPM

**右上角显示：**
- 精度百分比
- 最大连击数
- PERFECT/GOOD/MISS命中次数统计

### 2.2 游戏玩法需求

#### 2.2.1 节拍系统
- 节拍从屏幕顶部生成并向下移动
- 下落速度：4像素/帧（60FPS）
- 节拍颜色：根据轨道区分（4种不同颜色）
- 支持多种音符类型：
  - 4分音符（基础节拍）
  - 8分音符（标记为"8"）
  - 16分音符（标记为"16"）
  - 强音符（金色边框，更亮颜色）
  - 弱音符（灰色边框，较暗颜色）

#### 2.2.2 操作方式
**键盘输入**（支持的环境）：
- A键：控制第1轨道
- S键：控制第2轨道
- D键：控制第3轨道
- F键：控制第4轨道

**触摸输入**：
- 点击屏幕下方对应轨道区域
- 支持多点触控

#### 2.2.3 判定系统
判定标准：
- **PERFECT**：节拍中心点在PERFECT区域内（屏幕高度的1/6范围）
  - 基础分数：300分
  - 音效：鼓声效果
  - 震动：中等强度
  
- **GOOD**：节拍中心点在GOOD区域内（判定区域减去PERFECT区域）
  - 基础分数：200分
  - 音效：普通音效
  - 震动：轻微强度
  
- **MISS**：未命中或超出判定区域
  - 分数：0分
  - 中断连击数
  - 音效：错误音效

### 2.3 评分系统需求

#### 2.3.1 分数计算
- 基础分数乘以连击倍率
- 连击倍率：1 + (连击数 × 0.1)，最高3倍
- 实时更新总分

#### 2.3.2 连击系统
- 连续命中（PERFECT或GOOD）增加连击数
- MISS时重置连击数为0
- 记录最大连击数

#### 2.3.3 精度统计
- 计算公式：(PERFECT + GOOD) / 总节拍数 × 100%
- 实时显示当前精度
- 游戏结束时显示最终精度

### 2.4 节奏模式需求

#### 2.4.1 传统模式
支持4种基础节奏类型：
1. **4分音符模式**
   - 基础节拍
   - 适合新手
   - BPM: 60-120

2. **8分音符模式**
   - 中等速度
   - 稍有挑战
   - BPM: 80-140

3. **16分音符模式**
   - 快速节拍
   - 挑战极限
   - BPM: 100-160

4. **混合模式**
   - 多种节拍混合
   - 最高难度
   - 动态切换节奏类型

#### 2.4.2 模式选择模式
基于JSON配置的节奏模式库：
- 预定义的节奏模式（basic, eighth, sixteenth, complex, breakbeat等）
- 每个模式包含：
  - 模式名称
  - 难度等级（easy, medium, hard, expert）
  - BPM设置
  - 时间签名（如4/4）
  - 轨道模式定义
  - 模式描述

### 2.5 难度系统需求

#### 2.5.1 动态难度调整（传统模式）
- 初始BPM：用户选择（40-200）
- 每16个节拍增加5 BPM（最高120）
- 节拍模式随进度增加复杂度
- 32节拍后启用16分音符

#### 2.5.2 固定难度（模式选择模式）
- BPM由选择的模式决定
- 节拍模式固定
- 难度标签：easy/medium/hard/expert

### 2.6 反馈系统需求

#### 2.6.1 视觉反馈
- 按键高亮：按下时轨道区域白色半透明高亮
- 判定区域可视化：PERFECT和GOOD区域颜色区分
- 实时统计信息更新
- 游戏结束界面显示详细统计

#### 2.6.2 音效反馈
- 鼓声效果（Web Audio API合成）
- PERFECT/GOOD/MISS不同音效
- 背景音乐支持（可选）

#### 2.6.3 触觉反馈
- PERFECT：中等强度震动
- GOOD：轻微震动
- 按键按下：轻微震动
- 功能按钮：轻微震动

### 2.7 游戏流程需求

#### 2.7.1 开始流程
1. 显示节奏选择器界面
2. 选择节奏模式（传统/模式选择）
3. 选择具体的节奏类型或模式
4. 设置BPM（40-200）
   - 按钮调整（±5）
   - 双击数字进入虚拟键盘输入
5. 点击"开始游戏"按钮
6. 进入游戏主界面

#### 2.7.2 游戏中流程
1. 节拍持续生成并下落
2. 玩家按键命中节拍
3. 系统判定并反馈
4. 更新分数和连击
5. 可通过设置按钮调整游戏参数

#### 2.7.3 结束流程
1. 游戏结束触发（暂未实现自动结束条件）
2. 显示游戏结束界面
3. 展示详细统计：
   - 最终得分
   - 最大连击
   - 精度
   - PERFECT/GOOD/MISS次数
4. 提供"重新开始"按钮

### 2.8 界面交互需求

#### 2.8.1 节奏选择器
- 显示时机：游戏开始前、游戏内唤醒
- 模式切换按钮：在传统模式和新模式间切换
- 下拉菜单：选择节奏类型/模式
- BPM调节器：
  - 减少/增加按钮
  - 双击数字区域打开虚拟键盘
- 虚拟键盘：
  - 3×4布局（数字0-9，退格←，确认✓）
  - 取消按钮
  - 输入范围验证（40-200）
- 半透明背景遮罩
- 游戏内可通过齿轮按钮唤醒

#### 2.8.2 游戏界面
- 模式唤醒按钮：左上角齿轮图标
- 实时信息显示
- 轨道系统可视化
- 节拍动画

## 3. 技术需求

### 3.1 平台要求
- **主要平台**：微信小程序
- **兼容性**：支持浏览器环境测试
- **屏幕适配**：竖屏显示

### 3.2 性能要求
- **帧率**：60 FPS
- **响应延迟**：<50ms
- **内存管理**：使用对象池管理游戏对象
- **流畅度**：无明显卡顿

### 3.3 数据管理
- **全局状态管理**：DataBus单例模式
- **对象池管理**：Pool类管理节拍对象
- **配置数据**：JSON格式存储节奏模式

### 3.4 资源要求

#### 3.4.1 图片资源
- 背景图片（bg.jpg）
- 通用UI元素（Common.png）
- 爆炸动画帧（explosion1-19.png）
- 游戏元素（hero.png, enemy.png, bullet.png）

#### 3.4.2 音频资源
- 背景音乐（bgm.mp3）
- 音效（boom.mp3, bullet.mp3）
- 动态鼓声（Web Audio API合成）

#### 3.4.3 配置文件
- 游戏配置（game.json）
- 项目配置（project.config.json）
- 节奏模式库（rhythm-patterns.json）

## 4. 用户体验需求

### 4.1 易用性
- 直观的操作界面
- 清晰的视觉反馈
- 详细的游戏统计

### 4.2 可访问性
- 支持键盘和触摸双输入
- 明确的视觉提示
- 适当的音效和震动反馈

### 4.3 趣味性
- 多样的节奏模式
- 渐进的难度系统
- 连击和分数系统激励

### 4.4 可扩展性
- 支持添加新的节奏模式
- 可自定义BPM范围
- 预留背景音乐同步接口
- 预留谱面编辑器扩展点

## 5. 非功能性需求

### 5.1 稳定性
- 无崩溃和内存泄漏
- 异常处理完善
- 数据加载失败的降级方案

### 5.2 可维护性
- 清晰的代码结构
- 模块化设计
- 完善的注释文档

### 5.3 可测试性
- 单元测试支持
- 浏览器环境测试
- 调试日志完善

## 6. 约束条件

### 6.1 技术约束
- 必须兼容微信小程序环境
- Canvas 2D渲染
- 不使用外部音乐库（使用Web Audio API）

### 6.2 性能约束
- 60FPS稳定帧率
- 节拍生成延迟<16ms
- 判定精度±16ms

### 6.3 资源约束
- 小程序包大小限制
- 音频资源大小优化
- 图片资源压缩

## 7. 未来扩展需求（可选）

### 7.1 音乐同步
- 导入背景音乐文件
- 自动BPM检测
- 节拍与音乐同步

### 7.2 谱面系统
- 谱面编辑器
- 自定义谱面导入
- 谱面分享功能

### 7.3 社交功能
- 在线排行榜
- 好友对战
- 成就系统

### 7.4 视觉增强
- 粒子效果
- 更丰富的动画
- 主题皮肤系统

---

**文档版本**：v1.0  
**创建日期**：2025-10-12  
**最后更新**：2025-10-12
